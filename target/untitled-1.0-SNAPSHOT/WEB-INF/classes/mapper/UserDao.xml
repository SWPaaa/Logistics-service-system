<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.swp.dao.UserDao">

    <!--pc端用户登录-->
    <select id="login" resultType="com.swp.model.dto.UserDTO">
        SELECT
            *
        FROM
            t_user
        WHERE
            username = #{username}
            AND password = #{password}
            AND is_delete = 0
        LIMIT 1
    </select>
    <!--管理端用户登录-->
    <select id="adminLogin" resultType="com.swp.model.dto.UserAdminLoginDTO">
        SELECT
            a.id AS userId,
            a.name AS name,
            a.status,
            d.id AS menuId,
            d.name AS menuName,
            d.parent_id AS parentId,
            d.link AS link,
            d.icon AS icon
        FROM
            t_user AS a LEFT JOIN t_user_roll AS b
                  ON a.id = b.user_id
            LEFT JOIN t_roll_menu AS c
                  ON b.roll_code = c.roll_code
            LEFT JOIN t_menu AS d
                  ON c.menu_id = d.id
        WHERE
            a.is_delete = 0
          AND b.is_delete = 0
          AND c.is_delete = 0
          AND d.is_delete = 0
          AND a.username = #{username}
          AND a.password = #{password}
    </select>
    <!--注册-->
    <insert id="save">
        INSERT INTO
            t_user(
                username,password,type,name,real_name,phone,remark,company_name,
                company_address,company_phone,company_url,sex,area_code)
        VALUES (
                #{username},#{password},#{type},
                #{name},#{realName},#{phone},#{remark},#{companyName},#{companyAddress},#{companyPhone},
                #{companyUrl},#{sex},#{areaCode}
                )
    </insert>
    <!--根据用户名获取数据-->
    <select id="getByUsername" resultType="com.swp.entity.UserEntity">
        SELECT * FROM t_user
        WHERE username = #{username}
        AND is_delete = 0
        LIMIT 1
    </select>
</mapper>